(this.webpackJsonpreoxplore=this.webpackJsonpreoxplore||[]).push([[0],{114:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"sync",(function(){return y})),n.d(a,"lossysync",(function(){return m})),n.d(a,"fifo",(function(){return O})),n.d(a,"filter",(function(){return g})),n.d(a,"transform",(function(){return k})),n.d(a,"syncdrain",(function(){return C})),n.d(a,"asyncdrain",(function(){return w})),n.d(a,"timer",(function(){return T})),n.d(a,"timeddelay",(function(){return N})),n.d(a,"timedtransformer",(function(){return D}));var r=n(3),s=n(4),o=n(5),c=n(6),i=n(8),l=n(7),u=n(1),d=n.n(u),h=n(53),f=n(54),v=(n(90),function(){function e(t,n,a,r){Object(s.a)(this,e),this.p=t,this.x=n,this.y=a,this.label=r,this.radius=20}return Object(o.a)(e,[{key:"display",value:function(){this.p.noStroke(),this.p.fill(255),this.p.ellipse(this.x,this.y,this.radius,this.radius),this.p.fill(10),this.p.text(this.label,this.x-5,this.y+4)}},{key:"clicked",value:function(e,t){return this.p.dist(e,t,this.x,this.y)<=this.radius}}]),e}());function p(e,t,n,a,r,s,o){var c=e.atan2(t.y-n.y,t.x-n.x),i={x:n.x,y:n.y};"start"===r?i={x:t.x,y:t.y}:"center"===r&&(i.x=(t.x+n.x)/2,i.y=(t.y+n.y)/2);var l=e.HALF_PI;o&&(l*=-1),e.push(),e.translate(i.x,i.y),e.rotate(c-l),(o||"start"===r)&&e.translate(0,4*-a),"big"===s?e.triangle(-a,a,a,a,0,-a/2):e.triangle(-a/2,2*a,a/2,2*a,0,a),e.pop()}function b(e,t,n,a){a&&e.drawingContext.setLineDash([5,10]),e.line(t.x,t.y,n.x,n.y),e.drawingContext.setLineDash([])}function y(e,t,n,a){b(e,t,n),p(e,t,n,a)}function m(e,t,n,a){b(e,t,n,!0),p(e,t,n,a)}function j(e,t,n,a,r){var s={x:(t.x+n.x)/2,y:(t.y+n.y)/2},o=e.atan2(t.y-n.y,t.x-n.x);e.push(),e.translate(s.x,s.y),e.rotate(o-e.HALF_PI),a.length>1?function(e,t,n,a){var r="line"===t&&"line"===n?4:8;e.push(),e.translate(0,r),x(e,t,a),e.pop(),e.push(),e.translate(0,-r),x(e,n,a),e.pop()}(e,a[0],a[1],r):x(e,a[0],r),e.pop()}function x(e,t,n){var a,r=null!==(a=null===n||void 0===n?void 0:n.size)&&void 0!==a?a:10;if("circle"===t)e.ellipse(0,0,r);else if("rectangle"===t){var s=r,o=2*r;e.rect(-s/2,-o/2,s,o)}else if("line"===t)e.rotate(e.HALF_PI),e.line(0,r,0,-r);else if("triangle"===t)(null===n||void 0===n?void 0:n.isTriangleBig)?e.triangle(-r,r,r,r,0,-r/2):e.triangle(-r/2,2*r,r/2,2*r,0,r);else if("zigzag"===t){e.push(),e.translate(0,-15),e.noFill(),e.beginShape();for(var c=-6,i=0;i<6;i++)e.vertex(c,6*i),c=-6==c?6:-6;e.endShape(),e.pop()}}function O(e,t,n,a){b(e,t,n),j(e,t,n,["rectangle"]),p(e,t,n,a)}function g(e,t,n,a){b(e,t,n),j(e,t,n,["zigzag"]),p(e,t,n,a)}function k(e,t,n,a){b(e,t,n),j(e,t,n,["triangle"],{isTriangleBig:!0}),p(e,t,n,a)}function C(e,t,n,a){b(e,t,n),p(e,t,n,a,"start"),p(e,t,n,a,"end","normal",!0)}function w(e,t,n,a){e.atan2(t.y-n.y,t.x-n.x),t.x,n.x,t.y,n.y;b(e,t,n),j(e,t,n,["line","line"]),p(e,t,n,a,"start"),p(e,t,n,a,"end","normal",!0)}function T(e,t,n,a){b(e,t,n),p(e,t,n,a),j(e,t,n,["circle"])}function N(e,t,n,a){b(e,t,n),p(e,t,n,a),j(e,t,n,["circle","circle"])}function D(e,t,n,a){b(e,t,n),p(e,t,n,a),j(e,t,n,["triangle","circle"],{isTriangleBig:!0})}var S=function(){function e(t,n,a,r){Object(s.a)(this,e),this.p=t,this.startNode=n,this.endNode=a,this.channelMode=r}return Object(o.a)(e,[{key:"display",value:function(){this.p.stroke(160),this.p.strokeWeight(2),this.p.fill(160);a[this.channelMode](this.p,this.startNode,this.endNode,10)}}]),e}();var X=n(0),Y=function(e){Object(i.a)(n,e);var t=Object(l.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getChannelNames",value:function(){var e=[],t=0;for(var n in a)e.push({id:t,name:n}),t++;return e}},{key:"render",value:function(){var e=this,t=this.getChannelNames().map((function(t){return Object(X.jsx)("button",{className:t.name===e.props.channelMode?"selected-button":"not-selected-button",onClick:function(n){e.props.changeChannel(t.name,n)},children:t.name},t.id)}));return Object(X.jsx)("div",{className:"ChannelButtons",children:t})}}]),n}(d.a.Component),E=n(57),B=n.n(E),F=n.p+"static/media/arrow.190cd4af.svg",z=function(e){Object(i.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(s.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).handleDownload=function(e,t){return function(n){n.preventDefault();var a=document.createElement("a");a.download=t;var r=new Blob([e],{type:"text/plain"});a.href=URL.createObjectURL(r),a.click(),URL.revokeObjectURL(a.href)}},e}return Object(o.a)(n,[{key:"render",value:function(){return Object(X.jsxs)("button",{type:"button",id:"download-button",onClick:this.handleDownload(this.props.fileData,this.props.fileName),children:[Object(X.jsx)("span",{children:"Download"}),Object(X.jsx)("img",{src:F,alt:"download icon"})]})}}]),n}(d.a.Component);var L=function(e){Object(i.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={treo:"",isCorrect:!0,nodesReference:{}},a.changeTreo=a.changeTreo.bind(Object(c.a)(a)),a}return Object(o.a)(n,[{key:"changeTreo",value:function(e){this.buildChannelsFromTreo(e)}},{key:"parseTreo",value:function(e){var t,n=function(){var e=[];for(var t in a)e.push(t);return e}(),s={},o=[],c=!0,i=e.split(/;\n/).slice(0,-1),l=Object(r.a)(i);try{for(l.s();!(t=l.n()).done;){var u=t.value;u=u.replace(/\s/g,"");if(u.match(/#.*/)){if(u.match(/#\d+\(\d+,\d+\)/)){var d=u.match(/#\d+/)[0].replace("#",""),h=u.match(/\(\d+/)[0].replace("(",""),f=u.match(/,\d+/)[0].replace(",","");s[d]={x:Number(h),y:Number(f)};continue}console.log("fix ".concat(u)),c=!1;break}if(!u.match(/[a-z]+\(\d+,\d+\)/)&&!u.match(/[a-z]+\(\d+,\d+\)\[.*,.*\]/)){console.error("fix ".concat(u)),c=!1;break}var v=u.match(/[a-z]+/)[0];if(!n.includes(v)){console.error("".concat(v," is not a valid channel")),c=!1;break}var p=u.match(/\(\d+,\d+\)/)[0].match(/\d+/g),b=Number(p[0]),y=Number(p[1]);if(!(b in s)||!(y in s)){console.log("fix nodes positions"),c=!1;break}o.push({startNode:{x:s[b].x,y:s[b].y,label:b},endNode:{x:s[y].x,y:s[y].y,label:y},channelMode:v})}}catch(m){l.e(m)}finally{l.f()}return{readyToDraw:c,channels:o}}},{key:"buildChannelsFromTreo",value:function(e){var t=this.parseTreo(e),n=t.readyToDraw,a=t.channels;n?(this.setState({isCorrect:!0}),this.props.updateDrawingBasedOnTreo(a)):this.setState({isCorrect:!1}),this.setState({treo:e})}},{key:"getTreoFromDrawing",value:function(e,t,n){var a,r,s="(".concat(e.label,",").concat(t.label,")");if("timer"===(r=n)||"timeddelay"===r||"timedtransformer"===r){var o=function(e){return"timer"===e?"[5, var - 1;]":"timeddelay"===e?"[5, 10;]":"timedtransformer"===e?"[5, var - 1;]":"[,]"}(n);a="".concat(n).concat(s).concat(o,";\n")}else a="".concat(n).concat(s,";\n");return a}},{key:"getNodesPositionsFromDrawing",value:function(e){var t,n="",a=Object(r.a)(e);try{for(a.s();!(t=a.n()).done;){var s=t.value,o=Math.trunc(s.x),c=Math.trunc(s.y);n+="# ".concat(s.label," (").concat(o,", ").concat(c,");\n")}}catch(i){a.e(i)}finally{a.f()}return n+"\n"}},{key:"componentDidUpdate",value:function(e){if(!B()(this.props.channels,e.channels)){var t,n=this.getNodesPositionsFromDrawing(this.props.nodes),a="",s=Object(r.a)(this.props.channels);try{for(s.s();!(t=s.n()).done;){var o=t.value;a+=this.getTreoFromDrawing(o.startNode,o.endNode,o.channelMode)}}catch(i){s.e(i)}finally{s.f()}this.props.saveTreoCode(a);var c=n+a;this.setState({treo:c})}}},{key:"render",value:function(){var e=this;return Object(X.jsxs)("div",{className:"Treo",children:[Object(X.jsxs)("header",{children:[Object(X.jsx)("h3",{className:"treo-title",children:"Treo"}),Object(X.jsx)(z,{fileData:this.state.treo,fileName:"treo.txt"})]}),Object(X.jsx)("textarea",{className:this.state.isCorrect?"right":"wrong",cols:"40",rows:"10",value:this.state.treo,onChange:function(t){e.changeTreo(t.target.value,t)}})]})}}]),n}(d.a.Component),M=n(16),P=n.n(M),R=n(23);var U=n(93),A={hostname:"localhost",port:8081,method:"POST"};function I(){return(I=Object(R.a)(P.a.mark((function e(t,n){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A.path=n,e.next=3,new Promise((function(e,n){var a=U.request(A,(function(t){console.log("statusCode: ".concat(t.statusCode)),t.on("data",(function(n){var a=(new TextDecoder).decode(n);e({status:t.statusCode,data:a})}))}));a.on("error",(function(e){console.error(e),n(e)})),a.write(t),a.end()}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var H=function(e,t){return I.apply(this,arguments)};var J=function(e){Object(i.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).renderButton=function(e,t,n,r){var s="/haskell/model"===t?function(e){return e.replace(/(\d+)/g,"a$1")}(a.props.treo):a.props.treo;return Object(X.jsx)("button",{type:"button",onClick:function(e){e.preventDefault(),a.handleClick(s,t,n,r,e)},children:e})},a.state={resultTitle:"",resultCode:"",resultError:"",resultFileName:""},a.handleClick=a.handleClick.bind(Object(c.a)(a)),a}return Object(o.a)(n,[{key:"handleClick",value:function(){var e=Object(R.a)(P.a.mark((function e(t,n,a,r){var s,o;return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return this.setState({resultError:"Error. Treo is empty."}),e.abrupt("return");case 3:return c=t,s=(new TextEncoder).encode(JSON.stringify({content:c})),e.next=6,H(s,n);case 6:200===(o=e.sent).status?this.setState({resultCode:o.data,resultTitle:a,resultError:"",resultFileName:r}):this.setState({resultError:"Error. Please verify if treo is correct."});case 8:case"end":return e.stop()}var c}),e,this)})));return function(t,n,a,r){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(X.jsx)("main",{className:"options-container",children:Object(X.jsxs)("p",{children:["This is a light version."," ",Object(X.jsx)("a",{href:"https://github.com/frame-lab/ReoXplore2",children:"See instructions"})," ","for running the project locally to get access to all features."]})})}}]),n}(d.a.Component),_=J,q=function(e){Object(i.a)(n,e);var t=Object(l.a)(n);function n(){var e;return Object(s.a)(this,n),(e=t.call(this)).state={channel:"sync",nodes:[],channels:[],treoEntry:[],treoCode:"",canvasX:800,canvasY:400},e.sketch=e.sketch.bind(Object(c.a)(e)),e.changeChannel=e.changeChannel.bind(Object(c.a)(e)),e.updateDrawingBasedOnTreo=e.updateDrawingBasedOnTreo.bind(Object(c.a)(e)),e.saveTreoCode=e.saveTreoCode.bind(Object(c.a)(e)),e}return Object(o.a)(n,[{key:"sketch",value:function(e){var t,n=this,a=1,s=!0,o=!1,c=this;function i(){if(!o){var n,i,l=!1,u=!1,d=Object(r.a)(c.state.nodes);try{for(d.s();!(i=d.n()).done;){var h=i.value;h.clicked(e.mouseX,e.mouseY)&&(s?t=h:n=h,l=!0)}}catch(p){d.e(p)}finally{d.f()}if(l||(n=new v(e,e.mouseX,e.mouseY,a),c.setState({nodes:c.state.nodes.concat(n)}),u=!0,t||(t=n)),!s){if(t!==n){var f=new S(e,t,n,c.state.channel);c.setState({channels:c.state.channels.concat(f)})}t=null}u&&a++,s=!s}}e.setup=function(){e.createCanvas(n.state.canvasX,n.state.canvasY).mouseClicked(i),e.textSize(12)},e.keyTyped=function(){o="d"===e.key},e.mouseDragged=function(){var t=e.mouseX>n.state.canvasX-25&&e.mouseY>n.state.canvasY-25&&e.mouseX<n.state.canvasX+25&&e.mouseY<n.state.canvasY+25,a=function(e,t,n){var a,s=Object(r.a)(n);try{for(s.s();!(a=s.n()).done;){var o=a.value,c=o.x+o.radius/2,i=o.y+o.radius/2;if(e<=c||t<=i)return!1}}catch(l){s.e(l)}finally{s.f()}return!0}(e.mouseX,e.mouseY,n.state.nodes);t&&a&&(e.resizeCanvas(e.mouseX,e.mouseY),n.setState({canvasX:e.mouseX,canvasY:e.mouseY})),o&&function(){var t,n=Object(r.a)(c.state.nodes);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.clicked(e.mouseX,e.mouseY)){var s,o=!1,i=Object(r.a)(c.state.nodes);try{for(i.s();!(s=i.n()).done;){var l=s.value;a.label!==l.label&&(l.clicked(e.mouseX,e.mouseY)&&(o=!0))}}catch(u){i.e(u)}finally{i.f()}o||(a.x=e.mouseX,a.y=e.mouseY,c.setState({nodes:c.state.nodes}))}}}catch(u){n.e(u)}finally{n.f()}}()},e.draw=function(){e.background(220),function(t,n){e.push(),e.stroke(100);for(var a=4;a<20;a+=4)e.line(t-2,n-a,t-a,n-2);e.pop()}(c.state.canvasX,c.state.canvasY),o&&(e.push(),e.textSize(12),e.textFont("monospace"),e.text("design mode",10,20),e.pop()),c.state.treoEntry.length>0&&function(t){var n,a=[],s=[],o=Object(r.a)(t);try{for(o.s();!(n=o.n()).done;){var i=n.value,l=new v(e,i.startNode.x,i.startNode.y,i.startNode.label),u=new v(e,i.endNode.x,i.endNode.y,i.endNode.label);a.push(l,u),s.push(new S(e,l,u,i.channelMode))}}catch(h){o.e(h)}finally{o.f()}var d=function(e){var t,n=[],a=[],s=Object(r.a)(e);try{for(s.s();!(t=s.n()).done;){var o=t.value;n.includes(o.label)||(a.push(o),n.push(o.label))}}catch(h){s.e(h)}finally{s.f()}return a}(a);c.setState({treoEntry:[],nodes:d,channels:s})}(c.state.treoEntry);var t,n=Object(r.a)(c.state.channels);try{for(n.s();!(t=n.n()).done;){t.value.display()}}catch(i){n.e(i)}finally{n.f()}var a,s=Object(r.a)(c.state.nodes);try{for(s.s();!(a=s.n()).done;){a.value.display()}}catch(i){s.e(i)}finally{s.f()}}}},{key:"changeChannel",value:function(e){this.setState({channel:e})}},{key:"updateDrawingBasedOnTreo",value:function(e){this.setState({treoEntry:e})}},{key:"saveTreoCode",value:function(e){this.setState({treoCode:e})}},{key:"render",value:function(){return Object(X.jsxs)("main",{children:[Object(X.jsx)("h1",{children:"ReoXplore"}),Object(X.jsxs)("section",{className:"grid-container",children:[Object(X.jsx)("h3",{children:"Channels"}),Object(X.jsx)(Y,{changeChannel:this.changeChannel,channelMode:this.state.channel}),Object(X.jsx)("div",{className:"p5container",children:Object(X.jsx)(f.a,{sketch:this.sketch})}),Object(X.jsx)(L,{nodes:this.state.nodes,channels:this.state.channels,updateDrawingBasedOnTreo:this.updateDrawingBasedOnTreo,saveTreoCode:this.saveTreoCode})]}),Object(X.jsxs)("section",{className:"options",children:[Object(X.jsx)("h3",{children:"Options"}),Object(X.jsx)(_,{treo:this.state.treoCode})]})]})}}]),n}(d.a.Component);Object(h.render)(Object(X.jsx)(q,{}),document.getElementById("root"))},85:function(e,t){},90:function(e,t,n){},97:function(e,t){},99:function(e,t){}},[[114,1,2]]]);
//# sourceMappingURL=main.40daf81b.chunk.js.map